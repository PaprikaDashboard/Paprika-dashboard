<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paprika Dashboard</title>
    
    <!-- U캜itavanje Tailwind CSS-a -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- U캜itavanje Fontova -->
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- U캜itavanje React-a i ReactDOM-a -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- U캜itavanje Babel-a -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- FIX: U캜itavanje Prop-types (neophodno za Recharts UMD) -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    
    <!-- FIX: Kori코캖enje stabilne verzije Recharts-a -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    
    <!-- U캜itavanje Lucide Ikonica -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { font-family: 'Rubik', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        // --- KONFIGURACIJA OKRU콯ENJA ---
        
        const { useState, useEffect, useRef } = React;
        
        const { 
            AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, 
            BarChart, Bar, Cell, PieChart, Pie, Legend 
        } = Recharts;

        // --- POPRAVKA IKONICA ---
        const LucideIcon = ({ name, size = 24, className, ...props }) => {
            // Poku코avamo da na캠emo ikonicu u globalnom 'lucide' objektu
            // Proveravamo i PascalCase (npr. DollarSign) i camelCase (npr. dollarSign)
            const iconKey = name;
            const iconKeyCamel = name.charAt(0).toLowerCase() + name.slice(1);
            
            const iconData = lucide.icons[iconKey] || lucide.icons[iconKeyCamel];
            
            if (!iconData) return null;
            
            return (
                <svg 
                    {...props}
                    width={size} 
                    height={size} 
                    viewBox="0 0 24 24" 
                    fill="none" 
                    stroke="currentColor" 
                    strokeWidth="2" 
                    strokeLinecap="round" 
                    strokeLinejoin="round"
                    className={className}
                    dangerouslySetInnerHTML={{ __html: iconData.map(child => {
                        const [tag, attrs] = child;
                        const attrString = Object.entries(attrs).map(([key, val]) => `${key}="${val}"`).join(' ');
                        return `<${tag} ${attrString} />`;
                    }).join('') }} 
                />
            );
        };

        const iconList = [
            'TrendingUp', 'TrendingDown', 'DollarSign', 'Users', 'ShoppingBag', 
            'BarChart3', 'PieChart', 'MapPin', 'ArrowUpRight', 'ArrowDownRight',
            'Clock', 'Star', 'Package', 'Sparkles', 'BrainCircuit', 'MessageSquareText', 
            'Loader2', 'X', 'LayoutDashboard', 'Settings', 'Save', 'Send', 'Bot', 'Info', 
            'ChevronDown', 'UserCheck', 'FileText', 'Bell', 'HelpCircle', 'Menu', 'LogIn', 'Lock', 'Mail',
            'ClipboardCheck', 'Droplets', 'Calendar', 'ChevronLeft', 'ChevronRight', 'LogOut', 'PanelLeftClose', 'PanelLeftOpen',
            'Wallet', 'Briefcase', 'Timer', 'Award', 'User', 'Shield', 'BadgeCheck', 'UserCircle', 'Store', 'ChefHat', 'Utensils',
            'Edit3', 'Check', 'Trash2', 'AlertTriangle'
        ];

        const Icons = {};
        iconList.forEach(name => {
            Icons[name] = (props) => <LucideIcon name={name} {...props} />;
        });

        const { 
            TrendingUp, TrendingDown, DollarSign, Users, ShoppingBag, 
            BarChart3, PieChart: PieIcon, MapPin, ArrowUpRight, ArrowDownRight,
            Clock, Star, Package, Sparkles, BrainCircuit, MessageSquareText, 
            Loader2, X, LayoutDashboard, Settings, Save, Send, Bot, Info, 
            ChevronDown, UserCheck, FileText, Bell, HelpCircle, Menu, LogIn, Lock, Mail,
            ClipboardCheck, Droplets, Calendar, ChevronLeft, ChevronRight, LogOut, PanelLeftClose, PanelLeftOpen,
            Wallet, Briefcase, Timer, Award, User, Shield, BadgeCheck, UserCircle, Store, ChefHat, Utensils,
            Edit3, Check, Trash2, AlertTriangle
        } = Icons;

        // --- APP CODE ---

        const PaprikaLogo = ({ className = "", collapsed = false }) => (
          <div className={`flex items-center gap-2 transition-all duration-300 ${className}`}>
            {!collapsed ? (
              <div className="flex flex-col justify-center">
                <span style={{ fontFamily: "'Rubik', sans-serif", fontWeight: 900, letterSpacing: '1px' }} className="text-2xl text-[#d13334] leading-none">PAPRIKA</span>
                <span style={{ fontFamily: "'Rubik', sans-serif", fontWeight: 700 }} className="text-lg text-[#d13334] leading-none mt-0.5 tracking-wide">Dashboard</span>
              </div>
            ) : (
               <span style={{ fontFamily: "'Rubik', sans-serif", fontWeight: 900 }} className="text-[#d13334] text-2xl">P</span>
            )}
          </div>
        );

        const calculateTenure = (startDateString) => {
          if (!startDateString) return 'Nepoznato';
          const start = new Date(startDateString);
          const now = new Date();
          if (isNaN(start.getTime())) return 'Nepoznat datum';
          let years = now.getFullYear() - start.getFullYear();
          let months = now.getMonth() - start.getMonth();
          let days = now.getDate() - start.getDate();
          if (days < 0) { months--; const prevMonth = new Date(now.getFullYear(), now.getMonth(), 0); days += prevMonth.getDate(); }
          if (months < 0) { years--; months += 12; }
          let result = [];
          if (years > 0) result.push(`${years} god`);
          if (months > 0) result.push(`${months} mes`);
          if (days > 0 && years === 0) result.push(`${days} dana`); 
          return result.length > 0 ? result.join(' ') : 'Tek po캜eo/la';
        };

        const calculateFullTenure = (startDateString) => {
          if (!startDateString) return '';
          const start = new Date(startDateString);
          const now = new Date();
          if (isNaN(start.getTime())) return '';
          let years = now.getFullYear() - start.getFullYear();
          let months = now.getMonth() - start.getMonth();
          let days = now.getDate() - start.getDate();
          if (days < 0) { months--; const prevMonth = new Date(now.getFullYear(), now.getMonth(), 0); days += prevMonth.getDate(); }
          if (months < 0) { years--; months += 12; }
          return `${years} godina, ${months} meseci, ${days} dana`;
        };

        const INITIAL_EMPLOYEES_DB = {
          paprika: {
            id: 'paprika',
            name: 'Paprika',
            address: 'Vojislava Ili캖a 80, Beograd',
            staff: [
              { id: 'p1', name: 'Ljilja', role: 'Pizza majstor', salary: '140.000 RSD', startDate: '2023-01-15', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'p2', name: 'Drag캜e', role: 'Pizza majstor', salary: '150.000 RSD', startDate: '2022-05-20', hoursToday: 8, hoursMonth: 168, note: '' },
              { id: 'p3', name: 'Nikola', role: 'Pizza majstor', salary: '130.000 RSD', startDate: '2024-02-10', hoursToday: 7, hoursMonth: 150, note: '' },
              { id: 'p4', name: 'Goca', role: 'Kuhinja', salary: '110.000 RSD', startDate: '2024-08-01', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'p5', name: 'Katarina', role: 'Kuhinja', salary: '130.000 RSD', startDate: '2023-11-15', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'p6', name: 'Jelena', role: '마lter radnik', salary: '130.000 RSD', startDate: '2023-03-01', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'p7', name: 'Aleksandra', role: '마lter radnik', salary: '130.000 RSD', startDate: '2023-06-15', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'p8', name: 'Ana', role: '마lter radnik', salary: '100.000 RSD', startDate: '2025-01-10', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'p9', name: 'Milo코', role: '마lter radnik', salary: '4.600 RSD / dan', startDate: '2024-12-01', hoursToday: 0, hoursMonth: 40, note: 'Radi 3-4 dana nedeljno' },
              { id: 'p10', name: 'Zorana', role: '마lter radnik', salary: '130.000 RSD', startDate: '2023-09-01', hoursToday: 8, hoursMonth: 160, note: 'Radi nekad u Paprici, nekad u Gyrosu' },
              { id: 'p11', name: 'Dane', role: 'Ro코tilj majstor', salary: '150.000 RSD', startDate: '2022-01-01', hoursToday: 8, hoursMonth: 170, note: '' },
              { id: 'p12', name: 'Bojan', role: 'Ro코tilj majstor', salary: '150.000 RSD', startDate: '2022-06-15', hoursToday: 8, hoursMonth: 165, note: '' },
              { id: 'p13', name: 'Aca', role: 'Ro코tilj majstor', salary: '140.000 RSD', startDate: '2023-02-01', hoursToday: 8, hoursMonth: 160, note: '' },
            ]
          },
          gyros: {
            id: 'gyros',
            name: 'Gyros',
            address: 'Gospodara Vu캜i캖a 200, Beograd',
            staff: [
              { id: 'g1', name: 'Nikola', role: 'Gyros majstor', salary: '150.000 RSD', startDate: '2022-03-15', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'g2', name: 'Bojan', role: 'Team Leader', salary: '150.000 RSD', startDate: '2021-05-10', hoursToday: 9, hoursMonth: 180, note: '' },
              { id: 'g3', name: 'Nenad', role: 'Gyros majstor', salary: '120.000 RSD', startDate: '2024-01-20', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'g4', name: 'Manuel', role: 'Gyros majstor', salary: '120.000 RSD', startDate: '2024-02-01', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'g5', name: 'Sanela', role: '마lter radnik', salary: '100.000 RSD', startDate: '2025-01-05', hoursToday: 8, hoursMonth: 150, note: '' },
              { id: 'g6', name: 'Rada', role: '마lter radnik', salary: '100.000 RSD', startDate: '2025-01-05', hoursToday: 8, hoursMonth: 150, note: '' },
              { id: 'g7', name: 'Natalija', role: '마lter radnik', salary: '4.240 RSD / dan', startDate: '2024-11-01', hoursToday: 0, hoursMonth: 30, note: 'Radi na dnevnice po potrebi' },
              { id: 'g8', name: 'Stefan', role: '마lter radnik', salary: '105.000 RSD', startDate: '2024-10-15', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'g9', name: 'Deni', role: 'Ispomo캖', salary: '110.000 RSD', startDate: '2024-05-01', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'g10', name: 'Luka', role: 'Gyros majstor', salary: '100.000 RSD', startDate: '2025-02-01', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'g11', name: 'Sre캖ko', role: 'Gyros majstor', salary: '5.390 RSD / dan', startDate: '2024-12-01', hoursToday: 0, hoursMonth: 20, note: 'Po potrebi' },
              { id: 'g12', name: 'Andrija', role: '마lter radnik', salary: '4.240 RSD / dan', startDate: '2025-01-15', hoursToday: 0, hoursMonth: 20, note: 'Po potrebi' },
              { id: 'g13', name: 'Nemanja', role: '마lter radnik', salary: '4.240 RSD / dan', startDate: '2025-01-15', hoursToday: 0, hoursMonth: 20, note: 'Po potrebi' },
            ]
          },
          radionica: {
            id: 'radionica',
            name: 'Radionica',
            address: 'Gospodara Vu캜i캖a 200, Beograd',
            staff: [
              { id: 'r1', name: 'Nada', role: 'Team Leader', salary: '140.000 RSD', startDate: '2021-08-01', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'r2', name: 'Vlada', role: 'Mesar', salary: '100.000 RSD', startDate: '2024-05-15', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'r3', name: 'Marijana', role: 'Priprema', salary: '110.000 RSD', startDate: '2023-11-01', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'r4', name: 'Meri', role: 'Priprema', salary: '100.000 RSD', startDate: '2024-09-01', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'r5', name: 'Alex', role: 'Priprema', salary: '80.000 RSD', startDate: '2025-02-01', hoursToday: 8, hoursMonth: 160, note: '' },
            ]
          },
          burgeri: {
            id: 'burgeri',
            name: 'Burgeri',
            address: 'Gospodara Vu캜i캖a 200 (u Radionici)',
            staff: [
              { id: 'b1', name: 'Nemanja', role: 'Burger majstor', salary: '110.000 RSD', startDate: '2024-04-01', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'b2', name: 'Duni', role: 'Burger majstor', salary: '100.000 RSD', startDate: '2024-09-15', hoursToday: 8, hoursMonth: 160, note: '' },
            ]
          },
          hangar: {
            id: 'hangar',
            name: 'Hangar',
            address: 'Omladinskih Brigada 88, Beograd',
            staff: [
              { id: 'h1', name: 'Jelena', role: 'Team Leader', salary: '140.000 RSD', startDate: '2022-10-01', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'h2', name: 'Jasmina', role: 'Priprema/Ro코tilj', salary: '120.000 RSD', startDate: '2023-05-15', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'h3', name: 'Miljana', role: '마lter radnik', salary: '100.000 RSD', startDate: '2024-07-01', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'h4', name: 'Katarina', role: '마lter radnik', salary: '100.000 RSD', startDate: '2024-08-01', hoursToday: 8, hoursMonth: 160, note: '' },
              { id: 'h5', name: 'Milica', role: '마lter radnik', salary: '90.000 RSD', startDate: '2026-01-20', hoursToday: 8, hoursMonth: 160, note: 'Na probi mesec dana' },
              { id: 'h6', name: 'Milan', role: '마lter radnik', salary: '120.000 RSD', startDate: '2023-12-01', hoursToday: 8, hoursMonth: 160, note: 'Odlazi iz firme do kraja februara' },
            ]
          }
        };

        const LiveEarningsWidget = ({ monthlySalary, checkInTime }) => {
          const [earnedToday, setEarnedToday] = useState(0);

          useEffect(() => {
            const hourlyRate = monthlySalary / 22 / 8;
            const perSecondRate = hourlyRate / 3600;
            const interval = setInterval(() => {
              const now = new Date();
              const secondsWorked = (now - checkInTime) / 1000;
              const earnings = secondsWorked * perSecondRate;
              setEarnedToday(earnings);
            }, 1000);
            return () => clearInterval(interval);
          }, [monthlySalary, checkInTime]);

          return (
            <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 relative overflow-hidden group h-full">
              <div className="flex justify-between items-start mb-4 relative z-10">
                <div className="p-3 rounded-2xl bg-emerald-50 text-emerald-600"><Wallet className="w-6 h-6" /></div>
                <div className="flex items-center gap-1 px-2 py-1 bg-emerald-100 rounded-lg">
                    <span className="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span>
                    <span className="text-[10px] font-bold text-emerald-700 uppercase">U쬴vo</span>
                </div>
              </div>
              <div className="relative z-10">
                <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Zarada Danas</p>
                <h3 className="text-3xl font-black text-slate-900 tracking-tight flex items-baseline gap-1">
                  {earnedToday.toFixed(2)} <span className="text-sm text-slate-400 font-bold">RSD</span>
                </h3>
                <p className="text-[10px] text-slate-400 font-bold mt-2 uppercase tracking-tight">Od check-ina u 08:00h</p>
              </div>
              <div className="absolute -bottom-4 -right-4 opacity-[0.05] group-hover:scale-110 transition-transform"><Wallet className="w-32 h-32 text-emerald-900" /></div>
            </div>
          );
        };

        const App = () => {
          const [isLoggedIn, setIsLoggedIn] = useState(false);
          const [userRole, setUserRole] = useState(null); 
          const [currentUserData, setCurrentUserData] = useState(null);

          const [activeTab, setActiveTab] = useState('overview');
          const [selectedEmployeeLocation, setSelectedEmployeeLocation] = useState('paprika'); 

          const [employeesDb, setEmployeesDb] = useState(INITIAL_EMPLOYEES_DB);
          const [selectedEmployee, setSelectedEmployee] = useState(null); 
          const [isEditingEmployee, setIsEditingEmployee] = useState(false);
          const [employeeFormData, setEmployeeFormData] = useState({});
          const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);

          const [isMobileSidebarOpen, setIsMobileSidebarOpen] = useState(false); 
          const [isDesktopSidebarOpen, setIsDesktopSidebarOpen] = useState(true);
          const [showUserMenu, setShowUserMenu] = useState(false);
          const [selectedLocation, setSelectedLocation] = useState('all');
          const [showLocationMenu, setShowLocationMenu] = useState(false);

          const locations = [
            { id: 'all', name: 'Sve Lokacije', address: 'Zbirni pregled' },
            { id: 'paprika_food', name: 'Paprika Food', address: 'Vojislava Ili캖a 80, Beograd' },
            { id: 'gyros_smash', name: 'Gyros & Smash', address: 'Gospodara Vu캜i캖a 200, Beograd' },
            { id: 'paprika_hangar', name: 'Paprika Hangar', address: 'Omladinskih Brigada 88, Beograd' }
          ];

          const [input, setInput] = useState("");
          const [messages, setMessages] = useState([
            { role: 'ai', text: 'Pozdrav! Ja sam va코 Paprika asistent. Analiziram podatke za januar 2026. Kako vam mogu pomo캖i danas?' }
          ]);
           
          const [showDatePicker, setShowDatePicker] = useState(false);
          const [dateRange, setDateRange] = useState({ start: new Date(2026, 0, 1), end: new Date(2026, 0, 31) });
           
          const chatEndRef = useRef(null);
          const mainContentRef = useRef(null);
           
          const [email, setEmail] = useState('office@paprikafood.rs');
          const [password, setPassword] = useState('1234');
          const [loginError, setLoginError] = useState('');
          const [isLoading, setIsLoading] = useState(false);

          const apiKey = ""; 
          const model = "gemini-2.5-flash-preview-09-2025";

          const USERS = {
            ADMIN: { role: 'admin', name: "Glavni Admin", roleLabel: "Administrator", password: "1234" },
            MANAGER: { role: 'manager', name: "Marko Markovi캖", roleLabel: "Generalni Menad쬰r", password: "2345" },
            LEAD: { role: 'lead', name: "Jovana Jovi캖", roleLabel: "Team Leader", password: "3456" },
            EMPLOYEE: { role: 'employee', name: "Todor Vu캜enovi캖", roleLabel: "Zaposleni", password: "4567", tenure: "1 godina i 4 meseca", monthlySalary: 100000, currentBonus: 15000, hoursToday: 4.25, hoursMonth: 142, checkInTime: new Date(new Date().setHours(new Date().getHours() - 4)) }
          };

          const data = {
            revenue: 27003480, laborCost: 5404500, totalCosts: 26243290,
            locations: [{ name: 'Paprika', value: 9332080 }, { name: 'Gyro', value: 9369310 }, { name: 'Smash', value: 1864260 }, { name: 'Hangar', value: 6437830 }]
          };
          const trendData = [{ month: 'Nov', prihod: 32.9, trosak: 23.7 }, { month: 'Dec', prihod: 34.9, trosak: 30.0 }, { month: 'Jan', prihod: 27.0, trosak: 26.2 }];
          const COLORS = ['#3b82f6', '#8b5cf6', '#ec4899', '#f59e0b'];
          const formatCurrency = (val) => new Intl.NumberFormat('sr-RS').format(val) + ' RSD';
          const formatDate = (date) => date.toLocaleDateString('sr-RS', { day: 'numeric', month: 'short', year: 'numeric' });

          const handleEmployeeClick = (employee) => {
            setSelectedEmployee(employee);
            setEmployeeFormData(employee);
            setIsEditingEmployee(false);
            setShowDeleteConfirm(false);
          };

          const handleSaveEmployee = () => {
            const updatedDb = { ...employeesDb };
            const staffList = updatedDb[selectedEmployeeLocation].staff;
            const index = staffList.findIndex(e => e.id === selectedEmployee.id);
            if (index !== -1) {
              staffList[index] = { ...employeeFormData };
              setEmployeesDb(updatedDb);
              setSelectedEmployee(employeeFormData);
              setIsEditingEmployee(false);
            }
          };

          const handleDeleteEmployee = () => {
              const updatedDb = { ...employeesDb };
              updatedDb[selectedEmployeeLocation].staff = updatedDb[selectedEmployeeLocation].staff.filter(e => e.id !== selectedEmployee.id);
              setEmployeesDb(updatedDb);
              setSelectedEmployee(null);
              setShowDeleteConfirm(false);
          };

          useEffect(() => {
            if (isLoggedIn) {
                window.scrollTo(0, 0);
                if (mainContentRef.current) mainContentRef.current.scrollTop = 0;
            }
          }, [isLoggedIn]);

          useEffect(() => {
            if (isLoggedIn && messages.length > 1) {
                chatEndRef.current?.scrollIntoView({ behavior: "smooth", block: "nearest" });
            }
          }, [messages, isLoggedIn]);

          const handleSend = async () => {
            if (!input.trim()) return;
            const userMsg = { role: 'user', text: input };
            setMessages(prev => [...prev, userMsg]);
            setInput("");
            setTimeout(() => {
                setMessages(prev => [...prev, { role: 'ai', text: "Ovo je demo verzija. Za prave odgovore potreban je API klju캜." }]);
            }, 1000);
          };

          const handleLogin = (e) => {
            e.preventDefault();
            setIsLoading(true);
            setLoginError('');
            setTimeout(() => {
                if (email !== 'office@paprikafood.rs') {
                     setLoginError('Pogre코an email. Koristite office@paprikafood.rs');
                     setIsLoading(false);
                     return;
                }
                let userFound = null;
                if (password === USERS.ADMIN.password) userFound = USERS.ADMIN;
                else if (password === USERS.MANAGER.password) userFound = USERS.MANAGER;
                else if (password === USERS.LEAD.password) userFound = USERS.LEAD;
                else if (password === USERS.EMPLOYEE.password) userFound = USERS.EMPLOYEE;
                if (userFound) {
                    setIsLoggedIn(true);
                    setUserRole(userFound.role);
                    setCurrentUserData(userFound);
                    setActiveTab(userFound.role === 'employee' ? 'overview' : 'overview');
                } else {
                    setLoginError('Pogre코na lozinka.');
                }
                setIsLoading(false);
            }, 1000);
          };

          const handleLogout = () => {
            setIsLoggedIn(false);
            setUserRole(null);
            setCurrentUserData(null);
            setShowUserMenu(false);
            setPassword('');
          };

          const quickSwitch = (userKey) => {
              const user = USERS[userKey];
              setUserRole(user.role);
              setCurrentUserData(user);
              setShowUserMenu(false);
              setActiveTab('overview');
          };

          const handleLocationSelect = (locId) => {
              setSelectedLocation(locId);
              setShowLocationMenu(false);
          };

          const getSelectedLocationData = () => {
              return locations.find(l => l.id === selectedLocation) || locations[0];
          };

          const getRoleColor = (role) => {
              const r = role.toLowerCase();
              if (r.includes('team leader')) return 'bg-purple-100 text-purple-700';
              if (r.includes('majstor')) return 'bg-orange-100 text-orange-700';
              return 'bg-blue-50 text-blue-600';
          };

          const NavigationContent = ({ compact }) => (
            <div className="space-y-4">
              {userRole !== 'employee' && (
                <div className="space-y-1">
                    {!compact && <p className="px-4 text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">Glavni Meni</p>}
                    <button onClick={() => setActiveTab('overview')} className={`w-full group flex items-center gap-3 p-2.5 rounded-2xl transition-all text-left ${activeTab === 'overview' ? 'bg-slate-900 text-white shadow-lg' : 'hover:bg-slate-50 text-slate-600'} ${compact ? 'justify-center' : ''}`} title={compact ? 'Analitika' : ''}>
                        <BarChart3 className={`w-4 h-4 ${activeTab === 'overview' ? 'text-white' : 'text-slate-400 group-hover:text-slate-900'}`} />{!compact && <span className="text-xs font-bold">Analitika</span>}
                    </button>
                    <button onClick={() => setActiveTab('employees')} className={`w-full group flex items-center gap-3 p-2.5 rounded-2xl transition-all text-left ${activeTab === 'employees' ? 'bg-slate-900 text-white shadow-lg' : 'hover:bg-slate-50 text-slate-600'} ${compact ? 'justify-center' : ''}`} title={compact ? 'Zaposleni' : ''}>
                        <Users className={`w-4 h-4 ${activeTab === 'employees' ? 'text-white' : 'text-slate-400 group-hover:text-slate-900'}`} />{!compact && <span className="text-xs font-bold">Zaposleni</span>}
                    </button>
                </div>
              )}
              <div className="space-y-1">
                {!compact && <p className="px-4 text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">Brze Akcije</p>}
                {[{ label: 'Poru캜i Zalihe', icon: Package }, { label: 'Izve코taj Smena', icon: FileText }, { label: 'Pode코avanja', icon: Settings }, { label: '캛ek lista', icon: ClipboardCheck }, { label: 'Zamena ulja', icon: Droplets }].map((item, i) => (
                    <button key={i} className={`w-full group flex items-center gap-3 p-2.5 rounded-2xl transition-all text-left hover:bg-blue-50 text-slate-600 hover:text-blue-600 ${compact ? 'justify-center' : ''}`} title={compact ? item.label : ''}>
                    <item.icon className="w-4 h-4 text-slate-400 group-hover:text-blue-600" />{!compact && <span className="text-xs font-bold">{item.label}</span>}
                    </button>
                ))}
              </div>
            </div>
          );

          const UserProfile = ({ compact }) => (
            <div className="relative">
              {showUserMenu && (
                <div className={`absolute bottom-full left-0 mb-3 w-64 bg-white rounded-3xl shadow-2xl border border-slate-100 p-3 z-50 animate-in slide-in-from-bottom-4 duration-300 ${compact ? 'left-14' : ''}`}>
                  <div className="mb-2 px-2 text-[10px] font-black text-slate-400 uppercase tracking-widest">Brza Promena Profila</div>
                  {Object.keys(USERS).map(key => (
                      <button key={key} onClick={() => quickSwitch(key)} className={`w-full flex items-center gap-3 p-2 rounded-xl transition-all mb-1 ${userRole === USERS[key].role ? 'bg-slate-100' : 'hover:bg-slate-50'}`}>
                        <div className="w-6 h-6 rounded-full bg-slate-200 flex items-center justify-center text-slate-600 font-bold text-[10px]">{USERS[key].name.charAt(0)}</div>
                        <div className="text-left"><p className="text-xs font-bold text-slate-700">{USERS[key].roleLabel}</p></div>
                      </button>
                  ))}
                  <div className="h-px bg-slate-100 my-2"></div>
                  <button onClick={handleLogout} className="w-full flex items-center gap-3 p-2 rounded-xl hover:bg-rose-50 text-rose-600 transition-colors text-left"><LogOut className="w-4 h-4" /> <span className="text-xs font-bold">Odjavi se</span></button>
                </div>
              )}
              <button onClick={() => setShowUserMenu(!showUserMenu)} className={`w-full flex items-center gap-3 p-2 rounded-xl hover:bg-slate-50 transition-colors cursor-pointer group ${compact ? 'justify-center' : ''}`}>
                <div className="w-9 h-9 rounded-full bg-red-100 flex items-center justify-center text-red-600 font-bold text-xs shrink-0 border-2 border-white shadow-sm">{currentUserData?.name.charAt(0)}</div>
                {!compact && (<div className="overflow-hidden flex-1 text-left"><p className="text-xs font-bold text-slate-700 truncate">{currentUserData?.name}</p><p className="text-[10px] text-slate-400 truncate">{currentUserData?.roleLabel}</p></div>)}
                {!compact && <ChevronDown className={`w-4 h-4 text-slate-300 transition-transform ${showUserMenu ? 'rotate-180' : ''}`} />}
              </button>
            </div>
          );

          if (!isLoggedIn) {
            return (
                <div className="min-h-screen bg-[#f8fafc] flex items-center justify-center p-4 font-sans">
                    <div className="bg-white w-full max-w-md p-8 md:p-10 rounded-[2.5rem] shadow-xl shadow-slate-200 border border-slate-100 animate-in fade-in zoom-in-95 duration-300">
                        <div className="flex flex-col items-center text-center mb-8"><div className="mb-6 p-4 bg-red-50 rounded-full animate-bounce-slow"><PaprikaLogo className="scale-125" /></div><h1 className="text-2xl font-black text-slate-900 mb-2">Dobrodo코li nazad</h1><p className="text-slate-500 text-sm font-medium">Unesite svoje podatke za pristup panelu.</p></div>
                        <form onSubmit={handleLogin} className="space-y-5">
                            <div className="space-y-2"><label className="text-xs font-bold text-slate-700 ml-1 uppercase tracking-wide">Email Adresa</label><div className="relative"><div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"><Mail className="h-5 w-5 text-slate-400" /></div><input type="text" className="w-full pl-11 pr-4 py-4 bg-slate-50 border border-slate-200 rounded-2xl text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all placeholder:text-slate-400" placeholder="Va코 email" value={email} onChange={(e) => setEmail(e.target.value)} /></div></div>
                            <div className="space-y-2"><div className="flex justify-between items-center ml-1"><label className="text-xs font-bold text-slate-700 uppercase tracking-wide">Lozinka</label></div><div className="relative"><div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"><Lock className="h-5 w-5 text-slate-400" /></div><input type="password" className="w-full pl-11 pr-4 py-4 bg-slate-50 border border-slate-200 rounded-2xl text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all placeholder:text-slate-400" placeholder="Va코a lozinka" value={password} onChange={(e) => setPassword(e.target.value)} /></div></div>
                            {loginError && <div className="p-3 bg-rose-50 border border-rose-100 rounded-xl text-rose-600 text-xs font-bold text-center animate-in slide-in-from-top-2">{loginError}</div>}
                            <button type="submit" disabled={isLoading} className="w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-2xl font-bold shadow-lg shadow-blue-200/50 transform active:scale-[0.98] transition-all flex items-center justify-center gap-2">{isLoading ? <><Loader2 className="w-5 h-5 animate-spin" /> Prijavljivanje...</> : <><LogIn className="w-5 h-5" /> Prijavi se</>}</button>
                        </form>
                    </div>
                </div>
            );
          }

          return (
            <div className="h-screen bg-[#f8fafc] text-slate-900 font-sans flex flex-col md:flex-row overflow-hidden animate-in fade-in duration-500">
               
              {selectedEmployee && (
                <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[70] flex items-center justify-center p-4">
                    <div className="bg-white rounded-[2.5rem] shadow-2xl max-w-2xl w-full p-8 animate-in zoom-in-95 duration-200 max-h-[90vh] overflow-y-auto relative">
                        {showDeleteConfirm && (
                            <div className="absolute inset-0 bg-white/95 backdrop-blur-sm z-[80] flex items-center justify-center rounded-[2.5rem] animate-in fade-in zoom-in-95">
                                <div className="text-center p-8 max-w-sm">
                                    <div className="w-16 h-16 bg-rose-100 text-rose-600 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce-slow">
                                        <AlertTriangle className="w-8 h-8" />
                                    </div>
                                    <h3 className="text-2xl font-black text-slate-900 mb-2">Pa쬹ja!</h3>
                                    <p className="text-slate-500 font-medium mb-8">Da li ste sigurni da 쬰lite trajno da obri코ete profil zaposlenog <strong>{selectedEmployee.name}</strong>?</p>
                                    <div className="flex gap-3">
                                        <button onClick={() => setShowDeleteConfirm(false)} className="flex-1 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold rounded-xl transition-colors">Odustani</button>
                                        <button onClick={handleDeleteEmployee} className="flex-1 py-3 bg-rose-600 hover:bg-rose-700 text-white font-bold rounded-xl transition-colors shadow-lg shadow-rose-200">Da, Obri코i</button>
                                    </div>
                                </div>
                            </div>
                        )}
                        <div className="flex justify-between items-start mb-8">
                            <div className="flex items-center gap-6">
                                <div className="w-20 h-20 rounded-full bg-slate-100 flex items-center justify-center text-3xl font-black text-slate-400 border-4 border-slate-50 shadow-md">
                                    {selectedEmployee.name.charAt(0)}
                                </div>
                                <div>
                                    <h2 className="text-2xl font-black text-slate-900">{selectedEmployee.name}</h2>
                                    <p className="text-sm font-bold text-slate-500 flex items-center gap-2 mt-1">
                                        <Briefcase className="w-4 h-4" /> {selectedEmployee.role}
                                    </p>
                                </div>
                            </div>
                            <button onClick={() => setSelectedEmployee(null)} className="p-3 bg-slate-100 hover:bg-rose-100 hover:text-rose-600 rounded-2xl transition-all shadow-sm">
                                <X className="w-6 h-6" />
                            </button>
                        </div>

                        <div className="space-y-6">
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="space-y-2">
                                    <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest px-1">Plata</label>
                                    <div className="relative">
                                        <Wallet className="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" />
                                        {isEditingEmployee ? (
                                            <input type="text" value={employeeFormData.salary} onChange={(e) => setEmployeeFormData({...employeeFormData, salary: e.target.value})} className="w-full pl-10 pr-4 py-3 bg-slate-50 rounded-xl border border-slate-200 font-bold focus:border-blue-500 outline-none" />
                                        ) : (
                                            <div className="w-full pl-10 pr-4 py-3 bg-slate-50 rounded-xl border border-slate-100 font-black text-lg">{selectedEmployee.salary}</div>
                                        )}
                                    </div>
                                </div>
                                <div className="space-y-2">
                                    <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest px-1">Datum zaposlenja</label>
                                    <div className="relative">
                                        <Calendar className="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" />
                                        {isEditingEmployee ? (
                                            <input type="date" value={employeeFormData.startDate} onChange={(e) => setEmployeeFormData({...employeeFormData, startDate: e.target.value})} className="w-full pl-10 pr-4 py-3 bg-slate-50 rounded-xl border border-slate-200 font-bold focus:border-blue-500 outline-none" />
                                        ) : (
                                            <div className="w-full pl-10 pr-4 py-3 bg-slate-50 rounded-xl border border-slate-100 font-bold">{calculateTenure(selectedEmployee.startDate)}</div>
                                        )}
                                    </div>
                                    {!isEditingEmployee && selectedEmployee.startDate && <p className="text-xs text-slate-400 font-medium px-1">U firmi: {calculateFullTenure(selectedEmployee.startDate)}</p>}
                                </div>
                                <div className="space-y-2">
                                    <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest px-1">Sati (Danas)</label>
                                    <div className="relative">
                                        <Timer className="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" />
                                        {isEditingEmployee ? (
                                            <input type="number" value={employeeFormData.hoursToday} onChange={(e) => setEmployeeFormData({...employeeFormData, hoursToday: e.target.value})} className="w-full pl-10 pr-4 py-3 bg-slate-50 rounded-xl border border-slate-200 font-bold focus:border-blue-500 outline-none" />
                                        ) : (
                                            <div className="w-full pl-10 pr-4 py-3 bg-slate-50 rounded-xl border border-slate-100 font-bold">{selectedEmployee.hoursToday}h</div>
                                        )}
                                    </div>
                                </div>
                                <div className="space-y-2">
                                    <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest px-1">Sati (Mesec)</label>
                                    <div className="relative">
                                        <Calendar className="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" />
                                        {isEditingEmployee ? (
                                            <input type="number" value={employeeFormData.hoursMonth} onChange={(e) => setEmployeeFormData({...employeeFormData, hoursMonth: e.target.value})} className="w-full pl-10 pr-4 py-3 bg-slate-50 rounded-xl border border-slate-200 font-bold focus:border-blue-500 outline-none" />
                                        ) : (
                                            <div className="w-full pl-10 pr-4 py-3 bg-slate-50 rounded-xl border border-slate-100 font-bold">{selectedEmployee.hoursMonth}h</div>
                                        )}
                                    </div>
                                </div>
                            </div>
                            <div className="space-y-2">
                                <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest px-1">Napomena</label>
                                {isEditingEmployee ? (
                                    <textarea value={employeeFormData.note} onChange={(e) => setEmployeeFormData({...employeeFormData, note: e.target.value})} className="w-full p-4 bg-slate-50 rounded-xl border border-slate-200 font-medium focus:border-blue-500 outline-none h-24 resize-none" />
                                ) : (
                                    <div className="w-full p-4 bg-slate-50 rounded-xl border border-slate-100 font-medium text-slate-600 min-h-[6rem]">{selectedEmployee.note || "Nema napomene."}</div>
                                )}
                            </div>
                            <div className="pt-6 border-t border-slate-100 flex gap-4">
                                {isEditingEmployee ? (
                                    <>
                                        <button onClick={handleSaveEmployee} className="flex-1 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition-colors flex items-center justify-center gap-2"><Check className="w-4 h-4" /> Sa캜uvaj Izmene</button>
                                        <button onClick={() => setShowDeleteConfirm(true)} className="px-4 py-3 bg-rose-50 text-rose-600 rounded-xl font-bold hover:bg-rose-100 transition-colors flex items-center justify-center gap-2"><Trash2 className="w-4 h-4" /></button>
                                        <button onClick={() => setIsEditingEmployee(false)} className="px-6 py-3 bg-slate-100 text-slate-600 rounded-xl font-bold hover:bg-slate-200 transition-colors">Odustani</button>
                                    </>
                                ) : (
                                    <button onClick={() => setIsEditingEmployee(true)} className="w-full py-3 bg-slate-900 text-white rounded-xl font-bold hover:bg-slate-800 transition-colors flex items-center justify-center gap-2"><Edit3 className="w-4 h-4" /> Izmeni Profil</button>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
              )}

              <aside className={`${isDesktopSidebarOpen ? 'w-64 p-6' : 'w-20 p-4'} bg-white border-r border-slate-200 flex flex-col shrink-0 hidden md:flex z-50 h-full transition-all duration-300`}>
                <div className={`flex items-center justify-between mb-8 ${isDesktopSidebarOpen ? 'pl-2' : 'justify-center'}`}>
                    {isDesktopSidebarOpen ? <PaprikaLogo /> : <span className="bg-[#d13334] text-white px-2 py-0.5 rounded-lg text-xl font-black">P</span>}
                    {isDesktopSidebarOpen && <button onClick={() => setIsDesktopSidebarOpen(false)} className="p-1.5 hover:bg-slate-100 rounded-lg text-slate-400"><PanelLeftClose className="w-4 h-4" /></button>}
                </div>
                <div className="flex-1 overflow-y-auto no-scrollbar"><NavigationContent compact={!isDesktopSidebarOpen} /></div>
                <div className={`mt-auto pt-6 border-t border-slate-100 shrink-0 ${!isDesktopSidebarOpen ? 'flex justify-center' : ''}`}><UserProfile compact={!isDesktopSidebarOpen} /></div>
              </aside>

              {isMobileSidebarOpen && (
                <div className="fixed inset-0 z-50 md:hidden flex">
                    <div className="fixed inset-0 bg-black/20 backdrop-blur-sm" onClick={() => setIsMobileSidebarOpen(false)}></div>
                    <aside className="w-72 bg-white h-full relative flex flex-col p-6 animate-in slide-in-from-left duration-300">
                        <div className="flex justify-between items-center mb-8 shrink-0"><PaprikaLogo /><button onClick={() => setIsMobileSidebarOpen(false)}><X className="w-6 h-6 text-slate-400" /></button></div>
                        <div className="flex-1 overflow-y-auto"><NavigationContent /></div>
                        <div className="mt-auto pt-6 border-t border-slate-100 shrink-0"><UserProfile /></div>
                    </aside>
                </div>
              )}

              <div className="flex-1 flex flex-col h-full overflow-hidden">
                <header className="bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-40 shrink-0">
                  <div className="px-6 md:px-8 h-20 flex items-center justify-between">
                    <div className="flex items-center gap-4">
                      <button onClick={() => setIsMobileSidebarOpen(true)} className="md:hidden p-2 hover:bg-slate-100 rounded-xl transition-colors"><Menu className="w-6 h-6 text-slate-700" /></button>
                      {!isDesktopSidebarOpen && <button onClick={() => setIsDesktopSidebarOpen(true)} className="hidden md:block p-2 hover:bg-slate-100 rounded-xl transition-colors mr-2"><PanelLeftOpen className="w-6 h-6 text-slate-500" /></button>}
                      <div>
                        <div className="flex items-center gap-2">
                            <h2 className="text-xl font-black text-slate-900 tracking-tight">
                                {userRole === 'employee' ? `Dobrodo코li, ${currentUserData.name.split(' ')[0]} 游녦` : (activeTab === 'employees' ? 'Zaposleni' : 'Pregled Poslovanja')}
                            </h2>
                            {userRole !== 'employee' && activeTab === 'overview' && (
                                <div className="relative ml-4">
                                    <button onClick={() => setShowLocationMenu(!showLocationMenu)} className="flex items-center gap-2 px-3 py-1.5 bg-slate-100 rounded-xl text-xs font-bold text-slate-700 hover:bg-slate-200 transition-colors"><Store className="w-4 h-4 text-slate-500" />{getSelectedLocationData().name}<ChevronDown className="w-3 h-3 text-slate-400" /></button>
                                    {showLocationMenu && (
                                        <div className="absolute top-full left-0 mt-2 w-64 bg-white rounded-2xl shadow-xl border border-slate-100 p-2 z-50 animate-in zoom-in-95 duration-200">
                                            {locations.map(loc => (
                                                <button key={loc.id} onClick={() => handleLocationSelect(loc.id)} className={`w-full text-left p-2.5 rounded-xl mb-1 transition-colors ${selectedLocation === loc.id ? 'bg-blue-50 text-blue-700' : 'hover:bg-slate-50 text-slate-600'}`}><p className="text-xs font-bold">{loc.name}</p><p className="text-[10px] text-slate-400 mt-0.5 truncate">{loc.address}</p></button>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                      </div>
                    </div>
                    {userRole !== 'employee' && activeTab !== 'employees' && (
                        <div className="flex items-center gap-3 md:gap-4">
                        <div className="relative">
                            <button onClick={() => setShowDatePicker(!showDatePicker)} className="flex items-center gap-2 bg-slate-100 p-1 pr-3 rounded-xl border border-slate-200 hover:bg-slate-200 transition-colors">
                                <div className="p-1.5 bg-white rounded-lg shadow-sm"><Calendar className="w-4 h-4 text-slate-600" /></div>
                                <div className="text-left"><p className="text-[9px] font-bold text-slate-400 uppercase leading-none">Period</p><p className="text-[10px] font-black text-slate-700 uppercase leading-none mt-0.5">{formatDate(dateRange.start)} - {formatDate(dateRange.end)}</p></div>
                                <ChevronDown className="w-3 h-3 text-slate-400 ml-1" />
                            </button>
                        </div>
                        </div>
                    )}
                  </div>
                </header>

                <main ref={mainContentRef} className="flex-1 overflow-y-auto p-4 md:p-8 scroll-smooth">
                  {userRole !== 'employee' && activeTab === 'overview' && (
                    <div className="flex flex-col xl:flex-row gap-8 h-full">
                        <div className="flex-1 space-y-8 min-w-0">
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
                                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 flex flex-col justify-between hover:shadow-md transition-all group relative h-full">
                                    <div className="flex justify-between items-start relative z-10"><div className="p-3 rounded-2xl bg-blue-50 text-blue-600"><DollarSign className="w-6 h-6" /></div><div className="flex items-center gap-1 text-sm font-bold text-rose-500"><ArrowDownRight className="w-4 h-4" />22.5%</div></div>
                                    <div className="mt-6 relative z-10"><p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Prihod</p><h3 className="text-xl font-black text-slate-900 tracking-tight">{formatCurrency(data.revenue)}</h3><p className="text-[9px] text-slate-400 font-bold mt-1 uppercase tracking-tight">Ukupno Bruto</p></div>
                                </div>
                                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 flex flex-col justify-between hover:shadow-md transition-all group relative h-full">
                                    <div className="flex justify-between items-start relative z-10"><div className="p-3 rounded-2xl bg-purple-50 text-purple-600"><Users className="w-6 h-6" /></div></div>
                                    <div className="mt-6 relative z-10"><p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Radna Snaga</p><h3 className="text-xl font-black text-slate-900 tracking-tight">{formatCurrency(data.laborCost)}</h3><p className="text-[9px] text-slate-400 font-bold mt-1 uppercase tracking-tight">20% u캜e코캖a</p></div>
                                </div>
                                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 flex flex-col justify-between hover:shadow-md transition-all group relative h-full">
                                    <div className="flex justify-between items-start relative z-10"><div className="p-3 rounded-2xl bg-slate-50 text-slate-500"><TrendingDown className="w-6 h-6" /></div></div>
                                    <div className="mt-6 relative z-10"><p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Tro코kovi</p><h3 className="text-xl font-black text-slate-900 tracking-tight">{formatCurrency(data.totalCosts)}</h3><p className="text-[9px] text-slate-400 font-bold mt-1 uppercase tracking-tight">97.2% udeo</p></div>
                                </div>
                                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 flex flex-col justify-between hover:shadow-md transition-all group relative h-full">
                                    <div className="flex justify-between items-start relative z-10"><div className="p-3 rounded-2xl bg-emerald-50 text-emerald-600"><TrendingUp className="w-6 h-6" /></div><div className="flex items-center gap-1 text-sm font-bold text-emerald-500"><ArrowUpRight className="w-4 h-4" />Pozitivan</div></div>
                                    <div className="mt-6 relative z-10"><p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Profit</p><h3 className="text-xl font-black text-slate-900 tracking-tight">760.190 RSD</h3><p className="text-[9px] text-slate-400 font-bold mt-1 uppercase tracking-tight">Operativni Rezultat</p></div>
                                </div>
                            </div>

                            <div className="space-y-6">
                                <div className="flex gap-6 border-b border-slate-200 overflow-x-auto pb-1">
                                    {['overview', 'locations', 'delivery'].map(tab => (
                                    <button key={tab} className={`pb-3 px-1 text-[11px] font-black uppercase tracking-widest transition-all relative whitespace-nowrap ${tab === 'overview' ? 'text-blue-600' : 'text-slate-400 hover:text-slate-600'}`}>{tab === 'overview' ? 'Trendovi' : tab === 'locations' ? 'Lokacije' : 'Dostava'}{tab === 'overview' && <div className="absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600 rounded-full"></div>}</button>
                                    ))}
                                </div>
                                <div className="bg-white p-6 md:p-8 rounded-[2rem] shadow-sm border border-slate-100 h-96 w-full">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <AreaChart data={trendData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
                                            <defs><linearGradient id="gP" x1="0" y1="0" x2="0" y2="1"><stop offset="5%" stopColor="#3b82f6" stopOpacity={0.1}/><stop offset="95%" stopColor="#3b82f6" stopOpacity={0}/></linearGradient></defs>
                                            <CartesianGrid vertical={false} stroke="#f1f5f9" />
                                            <XAxis dataKey="month" axisLine={false} tickLine={false} tick={{fill: '#94a3b8', fontSize: 11, fontWeight: 700}} dy={10} />
                                            <YAxis axisLine={false} tickLine={false} tick={{fill: '#94a3b8', fontSize: 11, fontWeight: 700}} tickFormatter={(val) => `${val/1000000}M`} />
                                            <Tooltip contentStyle={{borderRadius: '16px', border: 'none', boxShadow: '0 10px 15px -3px rgba(0,0,0,0.1)'}} formatter={(value) => [formatCurrency(value), ""]} />
                                            <Area type="monotone" dataKey="prihod" stroke="#3b82f6" strokeWidth={4} fill="url(#gP)" name="Prihod" />
                                            <Area type="monotone" dataKey="trosak" stroke="#94a3b8" strokeWidth={2} fill="transparent" strokeDasharray="5 5" name="Tro코ak" />
                                        </AreaChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                        </div>
                        <aside className="w-full xl:w-80 shrink-0 flex flex-col gap-6">
                            <div className="bg-white rounded-[2rem] shadow-sm border border-slate-100 flex flex-col overflow-hidden h-[500px] xl:h-auto xl:flex-1">
                                <div className="p-5 border-b border-slate-50 bg-slate-50/50 flex items-center justify-between">
                                    <div className="flex items-center gap-3"><div className="p-2 bg-white rounded-xl shadow-sm"><Bot className="w-5 h-5 text-blue-600" /></div><span className="text-sm font-bold text-slate-700">AI Konsultant</span></div>
                                    <span className="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span>
                                </div>
                                <div className="flex-1 p-4 overflow-y-auto space-y-4 bg-[#f8fafc]">
                                    {messages.map((msg, i) => (<div key={i} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}><div className={`max-w-[85%] p-3 rounded-2xl text-xs font-medium leading-relaxed ${msg.role === 'user' ? 'bg-blue-600 text-white rounded-tr-none' : 'bg-white text-slate-600 shadow-sm border border-slate-100 rounded-tl-none'}`}>{msg.text}</div></div>))}
                                    <div ref={chatEndRef} />
                                </div>
                                <div className="p-3 bg-white border-t border-slate-100">
                                    <div className="flex gap-2 bg-slate-50 p-1.5 rounded-xl border border-slate-200 focus-within:border-blue-300 transition-colors">
                                        <input value={input} onChange={(e) => setInput(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && handleSend()} placeholder="Pitaj me..." className="flex-1 bg-transparent px-3 text-xs font-medium outline-none" />
                                        <button onClick={handleSend} className="p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"><Send className="w-3 h-3" /></button>
                                    </div>
                                </div>
                            </div>
                        </aside>
                    </div>
                  )}

                  {userRole !== 'employee' && activeTab === 'employees' && (
                     <div className="space-y-8 animate-in fade-in duration-500">
                        <div className="flex flex-wrap gap-4">
                          {['paprika', 'gyros', 'radionica', 'burgeri', 'hangar'].map((locId) => {
                             const loc = employeesDb[locId];
                             const isSelected = selectedEmployeeLocation === locId;
                             return (
                               <button key={locId} onClick={() => setSelectedEmployeeLocation(locId)} className={`flex-1 min-w-[200px] p-4 rounded-2xl border transition-all text-left group relative overflow-hidden ${isSelected ? 'bg-slate-900 text-white border-slate-900 shadow-lg' : 'bg-white text-slate-600 border-slate-100 hover:border-slate-300'}`}>
                                  <div className="relative z-10"><h4 className="font-black text-lg mb-1">{loc.name}</h4><p className={`text-[10px] font-bold uppercase tracking-wide ${isSelected ? 'text-slate-400' : 'text-slate-400'}`}>{loc.address}</p></div>
                                  {isSelected && <div className="absolute top-0 right-0 w-24 h-24 bg-white/5 rounded-full blur-2xl -mr-8 -mt-8"></div>}
                               </button>
                             );
                          })}
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                           {employeesDb[selectedEmployeeLocation].staff.map((employee, i) => (
                              <div key={i} onClick={() => handleEmployeeClick(employee)} className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 hover:shadow-md transition-all group cursor-pointer hover:border-blue-200">
                                 <div className="flex justify-between items-start mb-4">
                                    <div className="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center text-lg font-black text-slate-500 border-4 border-white shadow-sm">{employee.name.charAt(0)}</div>
                                    <span className={`text-[10px] font-black px-2 py-1 rounded-lg uppercase tracking-wide ${getRoleColor(employee.role)}`}>{employee.role}</span>
                                 </div>
                                 <div>
                                    <h3 className="text-xl font-black text-slate-900 mb-1">{employee.name}</h3>
                                    <div className="flex items-center gap-2 text-sm font-bold text-slate-500 mb-4"><Wallet className="w-4 h-4" /> {typeof employee.salary === 'number' ? formatCurrency(employee.salary) : employee.salary}</div>
                                    <div className="p-3 bg-blue-50 rounded-xl border border-blue-100"><p className="text-[10px] font-bold text-blue-700 flex items-center gap-1.5"><Calendar className="w-3 h-3" /> {calculateTenure(employee.startDate)}</p></div>
                                 </div>
                              </div>
                           ))}
                        </div>
                     </div>
                  )}

                  {userRole === 'employee' && currentUserData && (
                    <div className="max-w-7xl mx-auto space-y-8 animate-in fade-in duration-500">
                        <div className="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100 flex flex-col md:flex-row items-center gap-8 relative overflow-hidden">
                            <div className="absolute top-0 right-0 p-8 opacity-5"><UserCheck className="w-64 h-64 text-slate-900" /></div>
                            <div className="w-24 h-24 rounded-full bg-slate-100 flex items-center justify-center text-3xl font-black text-slate-400 border-4 border-white shadow-lg relative z-10">{currentUserData.name.charAt(0)}</div>
                            <div className="flex-1 text-center md:text-left relative z-10">
                                <h2 className="text-3xl font-black text-slate-900 mb-1">{currentUserData.name}</h2>
                                <div className="flex items-center justify-center md:justify-start gap-4 text-sm font-bold text-slate-500"><span className="flex items-center gap-1.5"><Briefcase className="w-4 h-4" /> {currentUserData.roleLabel}</span><span className="w-1 h-1 bg-slate-300 rounded-full"></span><span className="flex items-center gap-1.5"><Clock className="w-4 h-4" /> {currentUserData.tenure}</span></div>
                            </div>
                            <div className="bg-slate-50 p-4 rounded-2xl border border-slate-100 text-center relative z-10 min-w-[180px]">
                                <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Mese캜ni Bonus</p>
                                <div className="text-2xl font-black text-emerald-600 flex items-center justify-center gap-2"><Award className="w-6 h-6" /> {formatCurrency(currentUserData.currentBonus)}</div>
                            </div>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 h-96 md:h-80">
                            <div className="md:col-span-1 h-full"><LiveEarningsWidget monthlySalary={currentUserData.monthlySalary} checkInTime={currentUserData.checkInTime} /></div>
                            <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 flex flex-col justify-between h-full relative overflow-hidden group">
                                <div className="flex justify-between items-start relative z-10"><div className="p-3 rounded-2xl bg-blue-50 text-blue-600"><Timer className="w-6 h-6" /></div></div>
                                <div className="space-y-6 relative z-10"><div><p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Radno vreme danas</p><h3 className="text-3xl font-black text-slate-900">{currentUserData.hoursToday}h</h3></div><div><p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Ukupno ovaj mesec</p><h3 className="text-3xl font-black text-slate-900">{currentUserData.hoursMonth}h</h3></div></div>
                                <div className="absolute -bottom-4 -right-4 opacity-[0.05] group-hover:scale-110 transition-transform"><Clock className="w-32 h-32 text-blue-900" /></div>
                            </div>
                            <div className="bg-slate-900 p-8 rounded-[2rem] text-white shadow-xl flex flex-col justify-between h-full relative overflow-hidden">
                                <div className="relative z-10"><div className="flex items-center gap-3 mb-6"><div className="p-2 bg-white/10 rounded-xl"><Calendar className="w-5 h-5 text-white" /></div><h4 className="font-bold">Tvoja Smena</h4></div><div className="space-y-4"><div className="flex justify-between items-center pb-4 border-b border-white/10"><span className="text-slate-400 text-xs font-bold">Po캜etak</span><span className="text-xl font-black">08:00</span></div><div className="flex justify-between items-center"><span className="text-slate-400 text-xs font-bold">Kraj</span><span className="text-xl font-black">16:00</span></div></div></div>
                                <div className="relative z-10 mt-6 pt-4 border-t border-white/10 text-center"><p className="text-[10px] font-bold text-emerald-400 uppercase tracking-widest animate-pulse">餃 Trenutno aktivan</p></div>
                                <div className="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full blur-3xl"></div>
                            </div>
                        </div>
                    </div>
                  )}
                </main>
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>
</body>
</html>
